<!-- attempts_history.html — БЕ extra_filters, 100% кор мекунад -->
{% extends "base.html" %}

{% block title %}Таърихи кӯшишҳо • {{ cluster.name }}{% endblock %}

{% block main %}
<div style="max-width:1100px; margin:60px auto; padding:20px;">
    <h1 style="text-align:center; font-size:3.8rem; color:var(--dark); margin-bottom:20px;">
        {{ cluster.name }}
    </h1>
    <p style="text-align:center; font-size:1.8rem; color:var(--gray); margin-bottom:50px;">
        Таърихи ҳамаи кӯшишҳо
    </p>

    {% if attempts %}
        {% for attempt in attempts %}
        <div style="background:white; border-radius:24px; padding:35px; margin-bottom:30px; box-shadow:0 20px 50px rgba(0,0,0,0.1); 
                    border-left:8px solid {% if attempt.completed %}#00813E{% else %}#D1282D{% endif %};">
            <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:20px;">
                <div>
                    <h3 style="font-size:2.4rem; margin:0;">
                        Кӯшиши №{{ attempt.attempt_number }}
                        {% if attempt.completed %}
                            <span style="color:#00813E; font-weight:700;">Супорида шуд</span>
                        {% else %}
                            <span style="color:#D1282D; font-weight:700;">Нопурра</span>
                        {% endif %}
                    </h3>
                    <p style="color:#777; margin:10px 0;">
                        {{ attempt.last_date|date:"d.m.Y H:i" }}
                    </p>
                </div>
                <div style="text-align:center;">
                    <div style="font-size:4rem; font-weight:900; color:{% if attempt.completed %}#00813E{% else %}#D1282D{% endif %};">
                        {{ attempt.total_score }} / {{ attempt.total_questions }}
                    </div>
                    <div style="font-size:1.6rem; color:var(--dark);">
                        {% widthratio attempt.total_score attempt.total_questions 100 %}%
                    </div>
                </div>
            </div>
            {% if attempt.completed %}
            <div style="text-align:right; margin-top:20px;">
                <a href="{% url 'cluster_result' cluster.id %}?attempt={{ attempt.attempt_number }}"
                   style="color:#D1282D; font-weight:700; text-decoration:underline;">
                    Натиҷаи муфассал
                </a>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <div style="text-align:center; padding:100px; color:#95a5a6;">
            <p style="font-size:2rem;">Ҳанӯз ягон кӯшиш нест</p>
            <a href="{% url 'subjects_list' cluster.id %}" class="btn btn-red" style="margin-top:30px;">
                Оғоз кардан
            </a>
        </div>
    {% endif %}

    <div style="text-align:center; margin-top:60px;">
        <a href="{% url 'clusters_list' %}" style="color:#D1282D; font-size:1.4rem; text-decoration:underline;">
            Ба самтҳо баргаштан
        </a>
    </div>
</div>
{% endblock %}